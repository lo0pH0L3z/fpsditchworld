version: "3.9"

services:
  # -------------------------------------------------
  # Jellyfin (User Configuration)
  # -------------------------------------------------
  jellyfin:
    image: jellyfin/jellyfin:latest
    container_name: jellyfin
    restart: unless-stopped
    environment:
      - TZ=Australia/Sydney
      - JELLYFIN_BASE_URL=/
      - JELLYFIN_PublishedServerUrl=https://flix.ditchworld.com
      - JELLYFIN_FFMPEG_ARGS=-protocol_whitelist file,http,https,tcp,tls,crypto
    volumes:
      # Config + Cache + Media Folders (local)
      - ./jellyfin/config:/config
      - ./jellyfin/cache:/cache
      - ./jellyfin/media/Movies:/media/Movies
      - ./jellyfin/media/Shows:/media/Shows
      - ./jellyfin/media/Music:/media/Music
      - ./jellyfin/media/Files:/media/Files
      - ./jellyfin/media/LIVE_TV:/media/LIVE_TV

      # Internal 500GB HDD (A:)
      - A:/Jellyfin/media/A-Movies:/media/A-Movies
      - A:/Jellyfin/media/A-Shows:/media/A-Shows
      - A:/Jellyfin/media/A-Music:/media/A-Music
      - A:/Jellyfin/media/A-Files:/media/A-Files

      # External 1TB HDD (B:)
      - B:/Jellyfin/media/B-Movies:/media/B-Movies
      - B:/Jellyfin/media/B-Shows:/media/B-Shows
      - B:/Jellyfin/media/B-Music:/media/B-Music
      - B:/Jellyfin/media/B-Files:/media/B-Files
      - B:/Jellyfin/media/B-LiveTV:/media/B-LiveTV

      # External 120GB SSD (E:)
      - E:/Jellyfin/media/E-Movies:/media/E-Movies
      - E:/Jellyfin/media/E-Shows:/media/E-Shows
      - E:/Jellyfin/media/E-Music:/media/E-Music
      - E:/Jellyfin/media/E-Files:/media/E-Files
      - E:/Jellyfin/media/E-Transcodes:/media/E-Transcodes

      # Custom index.html with Download button injection
      - ./jellyfin/index.html:/jellyfin/jellyfin-web/index.html

    networks:

      - internal

  # -------------------------------------------------
  # Download Stack (Integrated)
  # -------------------------------------------------

  # üß≤ qBittorrent
  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Australia/Sydney
      - WEBUI_PORT=8080
    volumes:
      - "./qbittorrent-config:/config"
      - "./downloads:/downloads"
      - "B:/torrents:/torrents"
      - "A:/Jellyfin/media:/media/A"
      - "B:/Jellyfin/media:/media/B"
      - "E:/Jellyfin/media:/media/E"
    ports:
      - "8080:8080"
      - "6881:6881"
      - "6881:6881/udp"
    restart: unless-stopped
    networks:
      - internal

  # üß© Jackett
  jackett:
    image: lscr.io/linuxserver/jackett:latest
    container_name: jackett
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Australia/Sydney
    volumes:
      - "./jackett-config:/config"
      - "./downloads:/downloads"
    ports:
      - "9117:9117"
    restart: unless-stopped
    networks:
      - internal

  # üé¨ Radarr
  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Australia/Sydney
    volumes:
      - "./radarr-config:/config"
      - "./Movies:/movies"
      - "./downloads:/downloads"
    ports:
      - "7878:7878"
    depends_on:
      - qbittorrent
      - jackett
    restart: unless-stopped
    networks:
      - internal

  # üì∫ Sonarr
  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Australia/Sydney
    volumes:
      - "./sonarr-config:/config"
      - "./TV Shows:/tv"
      - "./downloads:/downloads"
    ports:
      - "8989:8989"
    depends_on:
      - qbittorrent
      - jackett
    restart: unless-stopped
    networks:
      - internal

  # üí¨ Bazarr
  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Australia/Sydney
    volumes:
      - "./bazarr-config:/config"
      - "./Movies:/movies"
      - "./TV Shows:/tv"
    ports:
      - "6767:6767"
    depends_on:
      - radarr
      - sonarr
    restart: unless-stopped
    networks:
      - internal

  # üîç Prowlarr
  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Australia/Sydney
    volumes:
      - "./prowlarr-config:/config"
    ports:
      - "9696:9696"
    restart: unless-stopped
    networks:
      - internal

  # üåê Caddy Reverse Proxy
  caddy:
    build:
      context: ./caddy
    image: ditchflix-caddy:latest
    container_name: caddy
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    environment:
      - TZ=Australia/Sydney
    volumes:
      - "./caddy-data:/data"
      - "./caddy-config:/config"
      - "./jellyfin/config.json:/config/config.json:ro"
    networks:

      - internal
    depends_on:
      - jellyfin
      - sonarr
      - radarr
      - prowlarr
      - bazarr
      - qbittorrent

  # üöÄ Torrent Search Service (Custom)
  torrent-search:
    build:
      context: ./downloads-service
    container_name: torrent-search
    ports:
      - "8001:8001"
    environment:
      - JACKETT_URL=http://jackett:9117
      - QBIT_URL=http://qbittorrent:8080
      - JACKETT_API_KEY=${JACKETT_API_KEY}
      - QBIT_USER=${QBIT_USER}
      - QBIT_PASS=${QBIT_PASS}
    depends_on:
      - jackett
      - qbittorrent
    volumes:
      - "A:/Jellyfin/media:/media/A"
      - "B:/Jellyfin/media:/media/B"
      - "E:/Jellyfin/media:/media/E"
      - "B:/torrents:/torrents"
    restart: unless-stopped
    networks:
      - internal

networks:
  internal:
    driver: bridge
